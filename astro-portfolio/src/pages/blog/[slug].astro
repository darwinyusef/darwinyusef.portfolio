---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/darwinyusef/darwinyusef/refs/heads/master/information/blog.json';

export async function getStaticPaths() {
  const response = await fetch(GITHUB_RAW_URL);
  const posts = await response.json();

  return posts
    .filter((post: any) => post.is_active)
    .map((post: any) => ({
      params: { slug: post.slug },
      props: { post }
    }));
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const { slug } = Astro.params;
const { post } = Astro.props;
---

<Layout title={post.title}>
  <div class="min-h-screen bg-[#F8F8F8] dark:bg-[#0a0a0a]">
    <Header />

    <main class="relative">
      <!-- Hero Section with Cover Image -->
      <section class="relative h-[60vh] md:h-[70vh] overflow-hidden">
        {post.coverImage ? (
          <img
            src={post.coverImage}
            alt={post.title}
            class="w-full h-full object-cover"
          />
        ) : (
          <div class="w-full h-full bg-gradient-to-br from-primary via-purple-600 to-pink-600"></div>
        )}

        <!-- Gradient Overlay -->
        <div class="absolute inset-0 bg-gradient-to-t from-[#F8F8F8] dark:from-[#0a0a0a] via-transparent to-transparent"></div>

        <!-- Back Button -->
        <a
          href={`/${lang === 'es' ? '' : lang}/blog`}
          class="absolute top-8 left-4 md:left-8 z-10 flex items-center gap-2 px-4 py-2 bg-white/90 dark:bg-black/90 backdrop-blur-sm rounded-full text-sm font-medium text-gray-900 dark:text-white hover:bg-white dark:hover:bg-black transition-all duration-300 shadow-lg hover:shadow-xl"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          Volver
        </a>

        <!-- Floating Meta Badge -->
        <div class="absolute top-8 right-4 md:right-8 flex gap-2">
          <span class="px-3 py-1 bg-primary text-white text-xs font-bold rounded-full shadow-lg backdrop-blur-sm">
            {post.category}
          </span>
        </div>
      </section>

      <!-- Article Content -->
      <article class="max-w-4xl mx-auto px-6 -mt-32 relative z-10">
        <!-- Title Card -->
        <div class="bg-white dark:bg-[#1a1a1a] rounded-2xl shadow-2xl p-8 md:p-12 mb-8 border border-gray-100 dark:border-gray-800 transform transition-all duration-500 hover:shadow-3xl">
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 dark:text-white mb-6 leading-tight" style="font-family: 'Inter Tight', system-ui, sans-serif;">
            {post.title}
          </h1>

          <!-- Meta Information -->
          <div class="flex flex-wrap items-center gap-4 md:gap-6 text-sm text-gray-600 dark:text-gray-400 mb-6 pb-6 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center gap-2">
              <div class="w-10 h-10 rounded-full bg-gradient-to-br from-primary to-purple-600 flex items-center justify-center text-white font-bold text-sm">
                {post.author.split(' ').map(n => n[0]).join('')}
              </div>
              <span class="font-medium text-gray-900 dark:text-white">{post.author}</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="material-symbols-outlined text-lg">calendar_today</span>
              <span id="post-date"></span>
            </div>
            <div class="flex items-center gap-2">
              <span class="material-symbols-outlined text-lg">schedule</span>
              <span>{post.readTime}</span>
            </div>
          </div>

          <!-- Tags -->
          <div class="flex flex-wrap gap-2">
            {post.tags.map(tag => (
              <span class="px-3 py-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-xs font-medium rounded-full hover:bg-primary hover:text-white transition-colors duration-300 cursor-pointer">
                #{tag}
              </span>
            ))}
          </div>
        </div>

        <!-- Excerpt -->
        <div class="bg-white dark:bg-[#1a1a1a] rounded-2xl shadow-xl p-8 mb-8 border-l-4 border-primary transform transition-all duration-500 hover:shadow-2xl">
          <p class="text-lg md:text-xl text-gray-700 dark:text-gray-300 leading-relaxed italic">
            {post.excerpt}
          </p>
        </div>

        <!-- HTML Content from JSON -->
        <div class="bg-white dark:bg-[#1a1a1a] rounded-2xl shadow-xl p-8 md:p-12 mb-8 border border-gray-100 dark:border-gray-800">
          <div set:html={post.content}></div>
        </div>

        <!-- Share Section -->
        <div class="bg-white dark:bg-[#1a1a1a] rounded-2xl shadow-xl p-8 mb-8 border border-gray-100 dark:border-gray-800">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">Compartir este artículo</h3>
          <div class="flex flex-wrap gap-3">
            <button
              id="share-twitter"
              class="group flex items-center gap-2 px-5 py-3 bg-[#1DA1F2] text-white rounded-xl hover:bg-[#1a8cd8] transition-all duration-300 shadow-md hover:shadow-xl transform hover:-translate-y-1"
            >
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"></path>
              </svg>
              <span class="font-medium">Twitter</span>
            </button>

            <button
              id="share-linkedin"
              class="group flex items-center gap-2 px-5 py-3 bg-[#0077B5] text-white rounded-xl hover:bg-[#006399] transition-all duration-300 shadow-md hover:shadow-xl transform hover:-translate-y-1"
            >
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"></path>
                <circle cx="4" cy="4" r="2"></circle>
              </svg>
              <span class="font-medium">LinkedIn</span>
            </button>

            <button
              id="share-copy"
              class="group flex items-center gap-2 px-5 py-3 bg-gray-700 dark:bg-gray-600 text-white rounded-xl hover:bg-gray-600 dark:hover:bg-gray-500 transition-all duration-300 shadow-md hover:shadow-xl transform hover:-translate-y-1"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
              </svg>
              <span class="font-medium">Copiar enlace</span>
            </button>
          </div>
        </div>
      </article>
    </main>
  </div>
</Layout>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter+Tight:wght@400;500;600;700;800;900&display=swap');
</style>

<script define:vars={{ post }}>
  // Format date
  document.addEventListener('DOMContentLoaded', () => {
    const postDateEl = document.getElementById('post-date');
    if (postDateEl) {
      const date = new Date(post.publishDate);
      postDateEl.textContent = date.toLocaleDateString('es-ES', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    }

    // Share handlers
    const shareTwitter = document.getElementById('share-twitter');
    const shareLinkedIn = document.getElementById('share-linkedin');
    const shareCopy = document.getElementById('share-copy');

    if (shareTwitter) {
      shareTwitter.addEventListener('click', () => {
        const url = window.location.href;
        const text = post.title;
        window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`, '_blank');
      });
    }

    if (shareLinkedIn) {
      shareLinkedIn.addEventListener('click', () => {
        const url = window.location.href;
        window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`, '_blank');
      });
    }

    if (shareCopy) {
      shareCopy.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(window.location.href);
          const originalText = shareCopy.querySelector('span').textContent;
          shareCopy.querySelector('span').textContent = '¡Copiado!';
          setTimeout(() => {
            shareCopy.querySelector('span').textContent = originalText;
          }, 2000);
        } catch (err) {
          console.error('Error copying to clipboard:', err);
        }
      });
    }
  });
</script>
